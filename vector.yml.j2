api:
  address: 0.0.0.0:{{ PIPELINES_HTTP_PORT }}
  enabled: true
  graphql: true
  playground: true

sources:
  docker:
    type: docker_logs

  vector_metrics:
    type: internal_metrics

transforms:
  msg_parser:
    type: remap
    inputs: [docker]
    source: |
      .message = parse_json(.message) ?? .message

sinks:
  logs:
    inputs: [msg_parser]
    type: elasticsearch
    endpoints: [http://localhost:{{ LOGS_HTTP_PORT }}/insert/elasticsearch/]
    mode: bulk
    api_version: v8
    compression: gzip
    healthcheck:
      enabled: false
    query:
      _msg_field: message,msg,_msg,message.message,message.log
      _time_field: timestamp
      _stream_fields: host,container_name,source_type,label.com.docker.compose.service

  metrics:
    inputs: [vector_metrics]
    type: prometheus_remote_write
    endpoint: http://localhost:{{ METRICS_HTTP_PORT }}/api/v1/write
    healthcheck:
      enabled: false
